---
title: "Relative and Absolute Pitch Data"
output_dir: docs
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
editor_options: 
  chunk_output_type: console
---

This dashboard is the current repository for the Relative and Absolute Pitch project between Eastman, Peabody, and the University of Amsterdam.

For questions, please contact [Dave Baker](mailto:davidjohnbaker1@gmail.com).

The current ordering reflects the questions as they are asked on the survey.


```{r}
#----------------------------------------------------------------------
library(dplyr)
library(magrittr)
library(readr)
library(ggplot2)
library(ggridges)
library(stringr)
library(tidyr)
library(viridis)
#----------------------------------------------------------------------
source("R/cleaning_functions.R")
source("R/assemble_functions.R")
source("R/create_tables.R")
#----------------------------------------------------------------------

activity_table <- read_csv("data/cleaned_tables/activity_table.csv")
text_response_table <- read_csv("data/cleaned_tables/text_response_table.csv")
demographic_table <- read_csv("data/cleaned_tables/demographic_table.csv")


demo_key <- read_csv("data/demokey.csv")

def_table <- create_definition_table(df)

demo_key <- demo_key %>%
  rename(t_id = Key)

def_table_2 <- def_table %>%
  left_join(demo_key)


```

### Definitions of Absolute and Relative Pitch 


```{r, fig.width=10, fig.height=7}

agreement_plot <- def_table_2 %>%
  filter(response != 8) %>%
  filter(Question != is.na(Question)) %>%
  mutate(APRP = case_when(
    APRP == "ap" ~ "Absolute Pitch",
    APRP == "rp" ~ "Relative Pitch",
  )) %>%
  ggplot(aes(y = reorder(Question, response), x = response, fill = APRP)) +
  geom_density_ridges2() +
  scale_x_continuous(limits = c(0,7), breaks = seq(1,7,1)) +
  labs(title = "Agreeing on Definitions of \nAbsolute and Relative Pitch",
       subtitle = "N = 42",
       y = "Question",
       x = "Density",
       fill = "Question Bank") +
  theme_bw() +
  viridis::scale_fill_viridis(discrete = TRUE, begin = .1, end = .8)

agreement_plot
   
```

*** 

**Question**

Below are several possible definitions of relative pitch and absolute pitch. Using the seven point scale below, please indicate the degree to which you agree with each definition. The left hand side will always correspond with “I strongly disagree” and the right hand scale will correspond with “I strongly agree.” Selecting the middle of the scale would indicate that you neither agree nor disagree with the definition.

Remember that we are interested in what you think, based on your expertise and teaching experiences. We encourage you to use the full range of the rating scale.

Selecting NR (No Response) would indicate that you do not wish to respond to this question.

If none of these definitions matches your own personal definitions, you will have the chance to provide your own on the next page.

**Comments**

The first main plot here plots the general agreement and disagreement with each of the definitions of absolute and relative pitch.
Answers of "No Response" have been removed.

The answers are ordered in terms of the average response per question.
Answers at the top and bottom show the most grouping.

Eventually, the plan for this analysis is to PCA/Factor Analyse this data in order to see if both the AP/RP factors emerge as a dimension as well as the verbs.


### Relative Pitch Is... {data-commentary-width=400}

```{r}
df %>% 
  filter(trial_index == 3) %>%
  select(run_id, response ) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  filter(response != "NA") %>%
  filter(response != "not*.$") %>%
  filter(response != "na") %>%
  filter(response != "Not Applicable") %>%
  filter(response != "not applicable") %>%
  knitr::kable()

```

*** 

If you felt that none of the definitions of relative pitch on the page before were sufficient, please provide your own definition in the space below.

You are required to fill in some text. If you were happy with the definitions before, please just write Not Applicable.

Relative pitch is...


### Absolute Pitch is... 

```{r}
df %>% 
  filter(trial_index == 4) %>%
  select(run_id, response ) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  filter(response != "NA") %>%
  filter(response != "not*.$") %>%
  filter(response != "na") %>%
  filter(response != "Not Applicable") %>%
  filter(response != "not applicable") %>%
  knitr::kable()
```

*** 

If you felt that none of the definitions of absolute pitch were sufficient, please provide your own definition in the space below.

You are required to fill in some text. If you were happy with the definitions before, please just write Not Applicable.

Absolute pitch is...

### People With Absolute Pitch 

```{r, fig.width=10, fig.height= 7 }

people_table <- create_people_table(df)
people_key <- read_csv("PeopleTable2.csv")

people_key <- people_key %>%
  rename(t_id = key) %>%
  mutate(t_id = str_remove_all(t_id, "\'"))

people_plot <- people_table %>%
  left_join(people_key, by = "t_id") %>%
  filter(response != 8) %>%
  filter(Question != is.na(Question)) %>%
  mutate(APRP = case_when(
    APRP == "ap" ~ "Absolute Pitch",
    APRP == "rp" ~ "Relative Pitch"
  )) %>%
  ggplot(aes(y = reorder(Question, response), x = response, fill = APRP)) +
  geom_density_ridges2() +
  scale_x_continuous(limits = c(0,7), breaks = seq(1,7,1)) +
  labs(title = "Agreeing on Definitions of People\n with Absolute and Relative Pitch",
       subtitle = "N = 42",
       y = "Question",
       x = "Density",
       fill = "Question Bank") +
  theme_bw() +
  viridis::scale_fill_viridis(discrete = TRUE, begin = .1, end = .8)

people_plot

   

```

*** 

**Question**

Below are statements about people with relative and absolute pitch. Using the scale, please indicate the degree to which you agree with each statement, where the left hand side of the scale corresponds to 'I strongly disagree' and the right hand side of the scale corresponds to 'I strongly agree.' A selection in the middle would indicate that you neither agree nor disagree with the statement. Remember that we are interested in what you think, based on your expertise and teaching experiences.

**Comments**

### Select the average percentage of time per class period you currently spend fostering relative + absolute pitch skills.

```{r}
aprp_time_est_plot <- activity_table %>%
  filter(t_id %in% c("perc_class_time_ap", "perc_class_time_rp")) %>%
  mutate(response = as.numeric(response)) %>%
  mutate(t_id = case_when(
    t_id == "perc_class_time_ap" ~ "Absolute Pitch",
    t_id == "perc_class_time_rp" ~ "Relative Pitch"
  )) %>%
  ggplot(aes(response, fill = t_id)) +
  geom_histogram(bins = 40) +
  facet_wrap(~t_id, nrow = 2) +
  theme_bw() +
  viridis::scale_fill_viridis(discrete = TRUE, begin = .1, end = .8) +
  labs(title = "Classroom Time Devoted to \nAbsolute Pitch vs Relative Pitch in the Classroom",
       x = "Estimated Percentage of Time",
       y = "Frequency Count in Survey",
       fill = "Question Bank")

aprp_time_est_plot

```

*** 

**Notes**

This is presented as two questions, merged for one panel for analysis. 

AP RP in Classroom 

### How high a priority does your instituation/you put on relative/absolute pitch?

```{r}
activity_table %>%
  mutate(priority_bool = str_detect(t_id, "priority")) %>%
  filter(priority_bool == TRUE) %>%
  separate(col = t_id, into = c("who","priority","aprp","num"),sep = "_") %>%
  mutate(who = case_when(
    who == "inst" ~ "Institution",
    who == "you" ~ "You"
  )) %>%
  mutate(APRP = case_when(
    aprp == "ap" ~ "Absolute Pitch",
    aprp == "rp" ~ "Relative Pitch"
  )) %>%
  mutate(q_id = paste(who,"prioritises", APRP,"?")) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  facet_wrap(~q_id) +
  theme_bw() + 
  labs(title = "Who prioriti[sz]es what?",
       x = "Low Priority             <<                                                                 >>          High Priority")
  
```

*** 

- How high a priority does your institution's curriculum place in developing absolute pitch in your students?
- How high a priority does your institution's curriculum place in developing relative pitch in your students?
- How high a priority do you place in developing absolute pitch in your students?
- How high a priority do you place in developing relative pitch in your students?

**Notes**


### Use the text box below to describe a classroom activity you either use, know of, or can imagine that could be used to foster relative pitch in the classroom.

```{r}

df %>% 
  filter(trial_index %in% c(12,14,16,18,20)) %>%
  select(run_id, response) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()

```

*** 

**Question**

Use the text box below to describe a classroom activity you either use, know of, or can imagine that could be used to foster relative pitch in the classroom.

This is the first of five activities you will be prompted to give regarding relative pitch.

We require you to provide at least one activity using this page, and we will ask you to provide more activities on subsequent pages (although no response will be required for subsequent activities).

Please describe the activity below. The next slide will ask you to rate the which you described on several dimensions.

Your response will inform perceptual tasks we hope to build at a later stage of this research.

**Notes**

TODO: Join on Difficulty Level for Single Activities 
TODO: Check Import Code, some answers lost because csv import error!


### Use the text box below to describe a classroom activity you either use, know of, or can imagine that could be used to foster absolute pitch in the classroom.

```{r}
df %>% 
  filter(trial_index %in% c(25, 27, 29, 31, 33)) %>%
  select(run_id, response) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()
```

*** 

**Question**

Use the text box below to describe a classroom activity you either use, know of, or can imagine that could be used to foster absolute pitch in the classroom.

This is the first of five activities you will be prompted to give regarding absolute pitch.

We require you to provide at least one activity using this page, and we will ask you to provide more activities on subsequent pages (although no response will be required for subsequent activities).

Please describe the activity below. The next slide will ask you to rate the activity which you described on several dimensions.

Your response will inform perceptual tasks we hope to build at a later stage of this research.

**Notes**

TODO Make same merged table as in RP parallel question. 

### Please list examples of repertoire you use in your aural skills teaching (folk songs, Bach chorales, jazz, etc.).


```{r}

text_response_table %>%
  filter(t_id == "rep_list_free_response") %>%
  select(run_id, response) %>%
  knitr::kable()

```

*** 

### What percentage of your overall aural skills teaching time do you spend on Western classical repertoire compared to all other musical styles?

```{r}
df %>%
  filter(trial_index == 34) %>%
  select(run_id, response) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  theme_bw() +
  labs(title = "Percent of Time On Classical Rep")
   


```

*** 

**Question**

What percentage of your overall aural skills teaching time do you spend on Western classical repertoire compared to all other musical styles?

Putting the slider to the far left would indicate you spend 0% of the time on Western classical repertoire. Moving the slider to the far right would indicate you spend 100% of your time on Western classical repertoire.

**Notes**


### What repertoire do you wish you could teach or intend to teach in the aural skills classroom if given the opportunity?

```{r}
text_response_table %>%
  filter(t_id == "rep_list_intend_response") %>%
  select(run_id, response) %>%
  knitr::kable()
```

*** 

### Please list any activities you do in the aural skills classroom that don’t involve musical staff notation.

```{r}
text_response_table %>%
  filter(t_id == "no_notation_list") %>%
  select(run_id, response) %>%
  knitr::kable()
```

*** 



### What percentage of your teaching time in the aural skills classroom do you spend on activities that don't depend on notation?


```{r}
df %>%
  filter(trial_index == 37) %>%
  select(run_id, response) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  theme_bw() +
  labs(title = "Percent of Time Don't Depend on Notation") 

```

*** 



### What activities represent the majority of your teaching responsibilities? Choose all that apply.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 40) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\\[\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\]\\}$"))
  

# df %>%
#   select(run_id, trial_index, response) %>%
#   filter(trial_index == 40)  %>%
#   knitr::kable()
```

*** 

text

### How many years have you been teaching music in the classroom?


```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 41)  %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  mutate(response = as.numeric(response)) %>%
  mutate(median_years = median(response, na.rm = TRUE)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  geom_vline(xintercept = 19) +
  labs(title = "How many years have you been teaching music in the classroom?",
       subtitle = "Median @ 19 Years") +
  theme_bw()
  
```

*** 

- Obvious 85 outlier for 85 years of teaching! 

### Please list the highest ranked degree you have earned.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 42) %>%
    mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\\[\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\"\\]\\}$")) %>%
  count(response) %>%
  ggplot(aes(x = reorder(response,n), y = n)) +
  geom_histogram(stat = "identity") +
  theme_bw() +
  coord_flip() +
  labs(title = "Please list the highest ranked degree you have earned.")
  

```

*** 

text

### About how many years has it been since graduating with your highest earned degree?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 43) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()
```

*** 

text


### From what type of institution was your most recent degree?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 44) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\\[\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\"\\]\\}$"))

```

*** 

text

### What teaching role best describes you? Please choose one.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 45) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\}$")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\"$")) %>%
  count(response) %>%
  ggplot(aes(x = reorder(response,n), y = n)) +
  geom_histogram(stat = "identity") +
  theme_bw() +
  coord_flip() +
  labs(title = "What teaching role best describes you? Please choose one")
         
```

*** 

text

### I would characterize my own sense of absolute pitch as:

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 46) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  labs(title = "I would characterize my own sense of absolute pitch as:") +
  theme_bw()
  
```

*** 

text

### I would characterize my own sense of relative pitch as:

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 47) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  labs(title = "I would characterize my own sense of relative pitch as:") +
  theme_bw()
  
```

*** 

text

### How many years of aural skills have you taught in your professional career?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 49) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  mutate(response = str_remove_all(response, "\ years")) %>%
  mutate(response = str_remove_all(response, "asdf")) %>%
  mutate(response = as.numeric(response)) %>%
  ggplot(aes(x = response)) +
  geom_histogram() +
  theme_bw() +
  labs(title = "How many years of aural skills have you taught in your professional career?")
  
  
  
```

*** 

text

### What system did you learn when you were a student? Select all that apply.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 50) %>%
  knitr::kable()
```

*** 

text

### Where were you when you learned this system as a student?

```{r}

df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 51) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()
```

*** 

text

### What system do you prefer to teach? Select all that apply.


```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 52) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\\[\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\"\\]\\}$")) %>%
  knitr::kable()

```

*** 

text

### What system do you primarily teach at your institution? Select all that apply.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 53) %>%
  mutate(response = str_remove_all(string = response,pattern = "\\{\"Colors\"\\:\\[\"")) %>%
  mutate(response = str_remove_all(string = response,pattern = "\"\\]\\}$")) %>%
  knitr::kable()

```

*** 

text

### How many students are typically enrolled in one of your aural skills classes (or sections)?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 54) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()

```

*** 


### Tracking, Pitch Memory, Clefts 

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 55) %>%
  knitr::kable()
```

*** 

asdf


*** 

asdf

### In what type of institution do you teach? Choose all that apply.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 56) %>%
  knitr::kable()
```

*** 

asdf

### Approximately how many music majors are enrolled in the music program where you've most recently taught?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 57) %>%
  knitr::kable()
```

*** 

Approximately how many music majors are enrolled in the music program where you've most recently taught? Please include both undergraduate and graduate students if your school offers both. If you don't wish to provide a response, write 'No Response'.

### Please list the degrees/programs your current or most recent music program offers. Choose all that apply:

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 58) %>%
  knitr::kable()
```

*** 

asdf

### What rank do most aural skills teachers hold at your institution? Choose all that apply.

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 59) %>%
  knitr::kable()
```

*** 
asdf 

### What is the highest degree that MOST aural skills teachers have at your institution? Choose all that apply.


```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 60) %>%
  knitr::kable()
```

*** 

asdf

### In what country do you teach?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 61) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()

```

*** 
asdf

### In what state or province do you teach? Leave blank if not applicable.


```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 62) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()
```

*** 

asdf


### Do you have any feedback you would like to provide on this survey?

```{r}
df %>%
  select(run_id, trial_index, response) %>%
  filter(trial_index == 63) %>%
  mutate(response = str_remove_all(response, '[[:punct:]]')) %>%
  mutate(response = str_remove_all(response, "Q0")) %>%
  knitr::kable()
```

*** 

asdf


### Response Map 

```{r}
# Import Spreadsheet with States



```

*** 

asdf

